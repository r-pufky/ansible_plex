---
###############################################################################
# Feature Flags
###############################################################################
# Executed in numerical order.

# 1. Backup config to plex_cfg_backup_dir?
#
# Enabling will only process plex_flg_backup_* and exit role. Location created
# if non-existent. Service stopped for backup and restarted.
#
# Default: False.
plex_flg_backup_config: false

# 2. Backup DB to plex_cfg_backup_dir?
#
# Enabling will only process plex_flg_backup_* and exit role. Location created
# if non-existent. Service stopped for backup and restarted.
#
# Default: False.
plex_flg_backup_db: false

# 3. Run maintenance tasks?
#
# Prunes deprecated and old role files.
#
# Default: True.
plex_flg_maintenance: true

# 4. Install application?
#
# Creates required directories, checks/creates users, installs packages,
# scripts, and services. Stops existing service for re-configuration.
#
# Default: True.
plex_flg_install: true

# 5. Set Preferences.xml?
#
# File set using plex_cfg_preferences.
#
# Default: False.
plex_flg_preferences: false

# 6. Start Plex service after configuration?
#
# Started after configuration. Allows Plex to write or correct any invalid
# configuration files.
#
# Default: True.
plex_flg_start: true

# 7. Enable scheduled auto updates?
#
# Schedule based on plex_update_schedule. Entitlement upgrades are done in
# this step.
#
# Default: True.
plex_flg_auto_update: true

# 8. Enable scheduled DB repairs?
#
# Schedule based on plex_repair_schedule.
#
# Default: True.
plex_flg_db_repair: true

# 11. Enable validation?
#
# Verify service running after role application or fail.
#
# Default: True.
plex_flg_validate: true

###############################################################################
# Service
###############################################################################

# User that Plex will run under.
#
# 'media' will automatically be created using vars/main.yml if required. All
# other accounts are checked for existence.
#
# Default: 'media'.
plex_srv_user: 'media'

# Group that Plex will run under.
#
# 'media' will automatically be created using vars/main.yml if required. All
# other accounts are checked for existence.
#
# Default: 'media'.
plex_srv_group: 'media'

# Maximum number of plugins to run at once. Default: 6.
plex_srv_max_plugin_processes: 6

# Maximum plex process CPU stack size (bytes). Default: 3000.
plex_srv_max_stack_size: 3000

# Temporary file location.
#
# Default location used for transcoding and service files / auto updates.
# Automatically created with service user permissions if needed.
#
# Default: '/tmp'.
plex_srv_tmpdir: '/tmp'

# Enable syslog instead of logging to 'Plex Media Server.log'? Default: True.
plex_srv_use_syslog_enable: true

###############################################################################
# Config
###############################################################################

# Role backup location.
#
# All backup operations for a given role execution are stored locally on
# ansible controller with the format 'YYYY-MM-DDTHHMMSS_{FILE}'.
#
# plex_cfg_backup_dir: 'data/plex'
#
# Default: ''
plex_cfg_backup_dir: ''

# Plex Preferences.xml to set.
#
# Ansible controller path to source Preferences.xml (treated as a jinja2
# template allowing for ansible variable interpretation). Overwrites existing
# Preferences.xml.
#
# plex_cfg_preferences: 'host_vars/plex.example.com/Preferences.xml'
#
# Default: '' (disabled).
plex_cfg_preferences: ''

###############################################################################
# Auto updates
###############################################################################
# Automatic update script to check for and install updates. Updates will use
# Plex token and update channel from Preferences.xml. When enabled entitlements
# will be checked during role execution. Highly recommended.
#
# Script deployed to /etc/plex/plex_update and must be executed as root user.

# Update schedule (systemd TIME calendar format).
#
# Default: 'weekly' (weekly).
#
# Reference:
# * https://www.freedesktop.org/software/systemd/man/latest/systemd.time.html
plex_update_schedule: 'weekly'

###############################################################################
# Plex DB Repair
###############################################################################
# Database repair utility script provided by Plex Linux engineers to automate
# many of the DB maintenance tasks. Highly recommended.
#
# Script deployed to /etc/plex/DBRepair.sh and must be executed as root user.
#
# Squashed NFS mounted application directories cannot enable automatic DB
# repair without modifying and manually running the script itself.
#
# Reference:
# * https://github.com/ChuckPa/DBRepair

# Repair schedule (systemd TIME calendar format).
#
# Default: 'weekly' (weekly).
#
# Reference:
# * https://www.freedesktop.org/software/systemd/man/latest/systemd.time.html
plex_repair_schedule: 'weekly'

# Set cache age (days).
#
# Specify maximum age for PhotoTranscoder Cache images to be retained.
#
# Default: 30.
plex_repair_cache_age: 30

# Set Plex SQLite binary page_size.
#
# Set Plex SQLite 'page_size' for both Main and Blobs databases. If not
# present, default page size for host OS is used (typically 4096 to match OS
# page size).
#
# Normal Linux (ext4, xfs) filesystems do not need this customization because
# filesystem block size = 4096. ZFS users sometimes need to customize their
# datasets to improve I/O performance (HDDs vs SSDs). This capability allows
# them to compensate for some of those losses.
#
# Special Case:
# * Must be a power of 2, with 1024 (2^10) as Plex default.  (per SQLite 3.12.0
#   documentation). Any invalid value provided will be rounded up to next
#   integral value (1024, 2048, 4096 ... 65536) This may or may not be the
#   value you intended. Caution is advised.
# * May not exceed 65536 (per SQLite 3.12.0 documentation). Any value exceeding
#   65536 will be truncated to 65536.
#
# Default: 4096.
plex_repair_page_size: 4096

# DB repair options.
#
# Special Case:
# * Always be sure to use 'exit' for script to end during scheduled tasks.
# * Interactive commands are not recommended to use in scheduled tasks.
#
# Values:
#        stop: Stop Plex Media Server before operations.
#   automatic: Check, Repair/Optimize, and Reindex Database in one step.
#       check: Perform integrity check of database.
#      vacuum: Remove empty space from database without optimizing.
#      repair: Repair/Optimize databases.
#     reindex: Rebuild database indexes.
#       start: Start Plex Media Server after operations.
#      import: Import watch history from another database independent of Plex.
#     replace: Replace current databases with newest usable backup copy
#        show: Show log file.
#      status: Report status of PMS (run-state and databases).
#        undo: Undo last successful command.
#       prune: Prune (remove) old image files (jpeg,jpg,png) from
#              PhotoTranscoder cache.
#       purge: Purge (delete) all temporary files left behind by PMS &
#              transcoder.
#     deflate: Deflate a bloated PMS main database.
#      ignore: Ignore duplicate/constraint errors.
#      update: Check for updates.
#        quit: Quit immediately. Keep all temporary files.
#        exit: Exit with cleanup options.
#
# Default:
#   - 'update'
#   - 'stop'
#   - 'check'
#   - 'repair'
#   - 'reindex'
#   - 'prune'
#   - 'purge'
#   - 'deflate'
#   - 'start'
#   - 'exit'
#
# Reference:
# * https://github.com/ChuckPa/DBRepair
plex_repair_options:
  - 'update'
  - 'stop'
  - 'check'
  - 'repair'
  - 'reindex'
  - 'prune'
  - 'purge'
  - 'deflate'
  - 'start'
  - 'exit'
