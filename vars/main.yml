---
###############################################################################
# Plex Role Options
###############################################################################
# Use Debian package for installation.
#
# Updates:
# * Branch for new Debian releases.
# * KEEP a separate change log as changes are made.
# * Use bare-metal docs to validate package/process changes.
# * Update defaults.
# * Update tests for any changes.
# * Standard validation testing (yamllint, ansible-lint, to-do, no-qa).
# * Tag version.
#
# Reference:
# * https://forums.plex.tv/t/plex-media-server/30447

# Last time Plex options were validated against a default configuration.
plex___validate_date: '2026-02-13'
plex___validate_release: 'trixie'
plex___validate_version: '1.43.0.10467'

plex___bin_dir: '/usr/local/bin'
plex___opt_dir: '/opt/plex'
plex___install_dir: '/var/lib/plexmediaserver/Library/Application Support'
plex___root_dir: '{{ plex___install_dir ~ "/Plex Media Server" }}'
plex___db_dir: '{{ plex___root_dir ~ "/Plug-in Support/Databases" }}'
plex___preferences: '{{ plex___root_dir ~ "/Preferences.xml" }}'

###############################################################################
# APT Packages
###############################################################################
# Obtained from manual package install. Plex 1.43.0.10467 changed APT
# repository to a new location with updated keys to attempt to fix key signing
# issues and old package issues. See install.yml.
#
# Reference:
# * https://repo.plex.tv/scripts/setupRepo.sh
# * https://support.plex.tv/articles/200288586-installation/

plex___packages:
  - 'curl'  # plexupdate, dbrepair script.
  - 'plexmediaserver'
  - 'xmlstarlet'  # Bash XML parsing for auto update.

plex___apt_sources:
  - name: 'plexmediaserver'
    types:
      - 'deb'
    uris: 'https://repo.plex.tv/deb'
    suites:
      - 'public'
    components:
      - 'main'
    signed_by: 'https://downloads.plex.tv/plex-keys/PlexSign.v2.key'

###############################################################################
# DBRepair.sh
###############################################################################
# Database maintenance script.
#
# Reference:
# * https://github.com/ChuckPa/DBRepair

plex___repair_url: '{{
    "https://github.com/ChuckPa/PlexDBRepair/releases/latest/download/" ~
    "DBRepair.sh"
  }}'

###############################################################################
# Default Plex User/Group
###############################################################################

plex___group:
  name: 'media'
  gid: 5555

plex___user:
  name: 'media'
  group: 'media'
  uid: 5555
  shell: '/usr/sbin/nologin'
  home: '/nonexistent'
  create_home: false
  password: '!'
  password_lock: true
  update_password: 'always'
  expires: -1
  system: true
